<!doctype html>
<html lang="az">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>D…ôrs Planƒ± ‚Äî Multi-se√ßim + Light/Dark (All Skips)</title>
<style>
  :root{--bg:#0b1220;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--br:#334155;--btn:#0ea5e9;--sel:#22c55e}
  body.light{--bg:#f8fafc;--card:#ffffff;--text:#111827;--muted:#475569;--br:#cbd5e1;--btn:#0ea5e9;--sel:#16a34a}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 -apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:16px;transition:background .3s,color .3s}
  .wrap{max-width:820px;margin:0 auto}
  .card{background:var(--card);border:1px solid var(--br);border-radius:16px;padding:16px}
  h1{margin:0 0 8px;font-size:22px}
  p.lead{margin:0 0 12px;color:var(--muted)}
  label{display:block;margin:6px 0 6px;color:var(--muted);font-size:13px}
  input,select,button{width:100%;padding:10px 12px;border:1px solid var(--br);border-radius:12px;background:var(--bg);color:var(--text)}
  .seg{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 12px}
  .seg button{flex:1 1 120px;padding:10px 12px;border-radius:10px;border:1px solid var(--br);background:var(--bg);color:var(--text);font-weight:700}
  .seg button[aria-pressed="true"]{background:var(--btn);border-color:var(--btn);color:#fff}
  .grid{display:flex;gap:12px;flex-wrap:wrap}
  .ctrl{flex:1 1 250px;min-width:200px}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .btn{background:var(--btn);border-color:var(--btn);color:#fff;font-weight:700;cursor:pointer}
  .ghost{background:transparent}
  .box{margin-top:14px;padding:12px;border:1px dashed var(--br);border-radius:12px}
  .err{color:#ef4444;margin-top:6px}
  .warn{color:#f59e0b;margin:6px 0}
  .muted{color:var(--muted);font-size:12px}
  .themeToggle{float:right;margin-bottom:12px}
  /* Calendar */
  .cal{border:1px solid var(--br);border-radius:12px;overflow:hidden;margin-top:8px}
  .calHead{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-bottom:1px solid var(--br);background:var(--card)}
  .calHead h3{margin:0;font-size:16px}
  .calHead .nav{display:flex;gap:6px}
  .calGrid{display:grid;grid-template-columns:repeat(7,1fr)}
  .dow,.day{padding:9px 0;text-align:center;border-bottom:1px solid var(--br)}
  .dow{font-size:12px;color:var(--muted)}
  .day{cursor:pointer}
  .day.other{color:var(--muted)}
  .day.sel{background:rgba(34,197,94,.18)}
  .day.today{outline:2px solid var(--btn);outline-offset:-2px;border-radius:6px}
  .badgeWrap{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--br);border-radius:999px;background:var(--bg);font-size:12px}
  .badge b{color:var(--text)}
  .x{background:transparent;border:1px solid var(--br);border-radius:8px;padding:2px 6px;cursor:pointer}
</style>
</head>
<body>
  <!-- Salam dunya -->
<div class="wrap">
  <div class="card">
    <button id="themeBtn" class="themeToggle" type="button">üåû Light / üåô Dark</button>
    <h1>D…ôrs Planƒ±</h1>
    <p class="lead">‚Äì Normal: 7 d…ôrs bitm…ô tarixi ‚Üí K√∂hn…ô ‚ÄúD…ôrs 08‚Äù + Yeni ay 01‚Ä¶08.  + Sƒ±naq: ‚ÄúD…ôrs 01 sƒ±naq‚Äù + 02‚Ä¶08. ‚ÄúD…ôrs olmadƒ±‚Äù g√ºnl…ôrini t…ôqvimd…ôn se√ß.</p>

    <div class="seg" role="group" aria-label="Sƒ±naq rejimi">
      <button id="modeNo"  type="button" aria-pressed="true">‚Äì Normal</button>
      <button id="modeYes" type="button" aria-pressed="false">+ Sƒ±naq</button>
    </div>

    <div class="grid">
      <div class="ctrl" id="paneNormal">
        <label for="ended">7 d…ôrs n…ô vaxt bitdi? (YYYY-MM-DD)</label>
        <input id="ended" type="date">
      </div>

      <div class="ctrl" id="paneTrial" style="display:none">
        <label for="trial">Sƒ±naq d…ôrsi tarixi (YYYY-MM-DD)</label>
        <input id="trial" type="date">
      </div>

      <div class="ctrl">
        <label>H…ôft…ôd…ô <b>iki g√ºn</b> se√ß (1‚Äì7)</label>
        <div class="grid">
          <select id="day1" aria-label="G√ºn 1">
            <option value="">‚Äî G√ºn 1 ‚Äî</option>
            <option value="1">1 (Bazar ert…ôsi)</option><option value="2">2 (√á…ôr≈ü…ônb…ô ax≈üamƒ±)</option>
            <option value="3">3 (√á…ôr≈ü…ônb…ô)</option><option value="4">4 (C√ºm…ô ax≈üamƒ±)</option>
            <option value="5">5 (C√ºm…ô)</option><option value="6">6 (≈û…ônb…ô)</option><option value="7">7 (Bazar)</option>
          </select>
          <select id="day2" aria-label="G√ºn 2">
            <option value="">‚Äî G√ºn 2 ‚Äî</option>
            <option value="1">1 (Bazar ert…ôsi)</option><option value="2">2 (√á…ôr≈ü…ônb…ô ax≈üamƒ±)</option>
            <option value="3">3 (√á…ôr≈ü…ônb…ô)</option><option value="4">4 (C√ºm…ô ax≈üamƒ±)</option>
            <option value="5">5 (C√ºm…ô)</option><option value="6">6 (≈û…ônb…ô)</option><option value="7">7 (Bazar)</option>
          </select>
        </div>
        <div class="muted">M…ôs: 1 v…ô 5.</div>
      </div>
    </div>

    <label style="margin-top:8px">D…ôrs <b>olmadƒ±</b> g√ºnl…ôri (t…ôqvimd…ôn √ßox-se√ßim):</label>
    <div class="cal" id="calendar">
      <div class="calHead">
        <div class="nav">
          <button id="prev" type="button">‚üµ</button>
          <button id="todayBtn" type="button">Bug√ºn</button>
          <button id="next" type="button">‚ü∂</button>
        </div>
        <h3 id="calTitle">Ay, ƒ∞l</h3>
        <div></div>
      </div>
      <div class="calGrid" id="calGrid"></div>
    </div>
    <div class="badgeWrap" id="pickedWrap"></div>

    <div class="actions">
      <button id="go" class="btn" type="button">Hesabla</button>
      <button id="clear" class="ghost" type="button">T…ômizl…ô</button>
    </div>

    <div id="err" class="err" hidden></div>

    <div id="outOld" class="box" hidden></div>
    <div id="outNew" class="box" hidden>
      <div><b>Yeni ay planƒ±</b> ‚Äî <span id="daysTag" class="muted"></span></div>
      <ol id="list"></ol>
    </div>

    <div class="muted" style="margin-top:6px">G√ºn x…ôrit…ôsi: 1-B.e., 2-√á.a., 3-√á., 4-C.a., 5-C., 6-≈û., 7-B.</div>
  </div>
</div>

<script>
(function(){
  // ===== Theme =====
  document.getElementById("themeBtn").addEventListener("click",()=>document.body.classList.toggle("light"));

  // ===== Helpers =====
  const MONTHS=["Yanvar","Fevral","Mart","Aprel","May","ƒ∞yun","ƒ∞yul","Avqust","Sentyabr","Oktyabr","Noyabr","Dekabr"];
  const WD_FULL=["Bazar","Bazar ert…ôsi","√á…ôr≈ü…ônb…ô ax≈üamƒ±","√á…ôr≈ü…ônb…ô","C√ºm…ô ax≈üamƒ±","C√ºm…ô","≈û…ônb…ô"];
  const WD_SHORT=["B.e.","√á.a.","√á.","C.a.","C.","≈û.","B."];
  const jsDowToNum=d=>d===0?7:d; // 0..6 ‚Üí 1..7
  const numToName=n=>["","Bazar ert…ôsi","√á…ôr≈ü…ônb…ô ax≈üamƒ±","√á…ôr≈ü…ônb…ô","C√ºm…ô ax≈üamƒ±","C√ºm…ô","≈û…ônb…ô","Bazar"][n];
  const addDays=(d,n)=>{const x=new Date(d.getFullYear(),d.getMonth(),d.getDate()); x.setDate(x.getDate()+n); return x;};
  const parseYMD=s=>{const m=/^(\d{4})-(\d{2})-(\d{2})$/.exec(s); return m?new Date(+m[1],+m[2]-1,+m[3]):null;};
  const toYMD=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
  const fmtFull=d=>`${MONTHS[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}, ${WD_FULL[d.getDay()]}`;

  // ===== DOM =====
  const $=id=>document.getElementById(id);
  const modeNo=$("modeNo"), modeYes=$("modeYes"), paneNormal=$("paneNormal"), paneTrial=$("paneTrial");
  const ended=$("ended"), trial=$("trial"), day1=$("day1"), day2=$("day2");
  const go=$("go"), clearBtn=$("clear"), err=$("err"), outOld=$("outOld"), outNew=$("outNew"), list=$("list"), daysTag=$("daysTag");

  // ===== Calendar (multi-select) =====
  const calTitle=$("calTitle"), calGrid=$("calGrid"), pickedWrap=$("pickedWrap");
  const prevBtn=$("prev"), nextBtn=$("next"), todayBtn=$("todayBtn");
  const picked=new Set(); // "YYYY-MM-DD"
  let view=(()=>{const n=new Date(); return new Date(n.getFullYear(),n.getMonth(),1);})();

  function renderPickedBadges(){
    pickedWrap.innerHTML="";
    Array.from(picked).sort().forEach(s=>{
      const d=parseYMD(s);
      const el=document.createElement("div");
      el.className="badge";
      el.innerHTML=`<b>${s}</b> <span>${WD_FULL[d.getDay()]}</span> <button class="x" data-x="${s}" type="button">sil</button>`;
      pickedWrap.appendChild(el);
    });
    pickedWrap.querySelectorAll(".x").forEach(btn=>{
      btn.onclick=e=>{ picked.delete(e.currentTarget.getAttribute("data-x")); renderCalendar(); renderPickedBadges(); };
    });
  }

  function renderCalendar(){
    calTitle.textContent=`${MONTHS[view.getMonth()]} ${view.getFullYear()}`;
    calGrid.innerHTML="";
    for(let i=0;i<7;i++){ const h=document.createElement("div"); h.className="dow"; h.textContent=WD_SHORT[i]; calGrid.appendChild(h); }
    const first=new Date(view.getFullYear(),view.getMonth(),1);
    const leading=( (jsDowToNum(first.getDay())) + 6 ) % 7;
    const start=addDays(first,-leading);
    const todayStr=toYMD(new Date());

    for(let i=0;i<42;i++){
      const d=addDays(start,i); const ymd=toYMD(d);
      const cell=document.createElement("div"); cell.className="day";
      if(d.getMonth()!==view.getMonth()) cell.classList.add("other");
      if(ymd===todayStr) cell.classList.add("today");
      if(picked.has(ymd)) cell.classList.add("sel");
      cell.textContent=d.getDate();
      cell.onclick=()=>{ picked.has(ymd)?picked.delete(ymd):picked.add(ymd); renderCalendar(); renderPickedBadges(); };
      calGrid.appendChild(cell);
    }
  }
  prevBtn.onclick=()=>{ view=new Date(view.getFullYear(),view.getMonth()-1,1); renderCalendar(); };
  nextBtn.onclick=()=>{ view=new Date(view.getFullYear(),view.getMonth()+1,1); renderCalendar(); };
  todayBtn.onclick=()=>{ const n=new Date(); view=new Date(n.getFullYear(),n.getMonth(),1); renderCalendar(); };

  // ===== Mode =====
  function setMode(trialMode){
    modeNo.setAttribute("aria-pressed", String(!trialMode));
    modeYes.setAttribute("aria-pressed", String(trialMode));
    paneNormal.style.display=trialMode?"none":"block";
    paneTrial .style.display=trialMode?"block":"none";
  }
  modeNo.onclick=()=>setMode(false);
  modeYes.onclick=()=>setMode(true);

  // ===== Planner core (ALL skips) =====
  function nextAfter(date, allowedDays, skipSet){
    let d = addDays(date, 1);
    const skipped = [];

    while (true) {
      const dayNum = jsDowToNum(d.getDay());
      const ymd = toYMD(d);
      const isAllowed = allowedDays.includes(dayNum);

      if (isAllowed) {
        if (skipSet.has(ymd)) {
          // Bu g√ºn d…ôrs olmalƒ± idi, amma ‚Äúd…ôrs olmadƒ±‚Äù kimi i≈üar…ôl…ônib ‚Üí topla v…ô ke√ß
          skipped.push(new Date(d));
          d = addDays(d, 1);
          continue; // ard-arda ola bil…ôr
        } else {
          // n√∂vb…ôti real d…ôrs g√ºn√º tapƒ±ldƒ±
          return { date: d, skipped };
        }
      }
      // uyƒüun olmayan g√ºn ‚Üí bir g√ºn ir…ôli
      d = addDays(d, 1);
    }
  }

  function buildPlan(startExclusive, daysAllowed, skipSet, N){
    const out=[]; let cur=startExclusive;
    for(let i=1;i<=N;i++){ const step=nextAfter(cur,daysAllowed,skipSet); out.push(step); cur=step.date; }
    return out;
  }

  function validate(){
    err.hidden=true;
    const trialMode = modeYes.getAttribute("aria-pressed")==="true";
    const g1=Number(day1.value), g2=Number(day2.value);
    if(!(g1>=1&&g1<=7) || !(g2>=1&&g2<=7) || g1===g2){
      err.textContent="H…ôft…ôd…ô iki f…ôrqli g√ºn se√ßin (m…ôs: 1 v…ô 5)."; err.hidden=false; return null;
    }
    const skipSet=new Set(Array.from(picked)); // Y-M-D strings
    if(trialMode){
      const t=trial.value?parseYMD(trial.value):null;
      if(!t){ err.textContent="Sƒ±naq rejimind…ô sƒ±naq tarixini se√ßin."; err.hidden=false; return null; }
      return {trialMode:true, trial:t, days:[g1,g2].sort((a,b)=>a-b), skip:skipSet};
    }else{
      const b=ended.value?parseYMD(ended.value):null;
      if(!b){ err.textContent="Normal rejimd…ô 7 d…ôrsin bitdiyi tarixi se√ßin."; err.hidden=false; return null; }
      return {trialMode:false, base:b, days:[g1,g2].sort((a,b)=>a-b), skip:skipSet};
    }
  }

  function printSkipped(container, skippedArr){
    if(skippedArr && skippedArr.length){
      skippedArr.forEach(s=>{
        const note=document.createElement("div");
        note.className="warn";
        note.textContent=`Bu g√ºn d…ôrs olmadƒ±: ${fmtFull(s)} ‚Üí n√∂vb…ôti d…ôrs g√ºn√ºn…ô ke√ßirildi.`;
        container.appendChild(note);
      });
    }
  }

  function run(){
    const p=validate(); if(!p) return;
    outOld.hidden=true; outNew.hidden=true; list.innerHTML="";
    daysTag.textContent=`G√ºnl…ôr: ${p.days[0]} (${numToName(p.days[0])}), ${p.days[1]} (${numToName(p.days[1])})`;

    if(p.trialMode){
      outNew.hidden=false;
      const li0=document.createElement("li");
      li0.innerHTML=`<b>D…ôrs 01:</b> Sƒ±naq d…ôrsi ‚Äî ${fmtFull(p.trial)}`;
      list.appendChild(li0);

      const plan=buildPlan(p.trial,p.days,p.skip,7); // 02..08
      plan.forEach((it,i)=>{
        const li=document.createElement("li");
        li.innerHTML=`<b>D…ôrs ${String(i+2).padStart(2,'0')}:</b> ${fmtFull(it.date)}`;
        list.appendChild(li);
        printSkipped(list, it.skipped); // b√ºt√ºn atlananlarƒ± alt-alta yaz
      });

    }else{
      const old8=nextAfter(p.base,p.days,p.skip);
      outOld.hidden=false;
      outOld.innerHTML=`<b>K√∂hn…ô ay ‚Äî D…ôrs 08:</b> ${fmtFull(old8.date)}`;
      printSkipped(outOld, old8.skipped);

      outNew.hidden=false;
      const plan=buildPlan(old8.date,p.days,p.skip,8); // 01..08
      plan.forEach((it,i)=>{
        const li=document.createElement("li");
        li.innerHTML=`<b>D…ôrs ${String(i+1).padStart(2,'0')}:</b> ${fmtFull(it.date)}`;
        list.appendChild(li);
        printSkipped(list, it.skipped);
      });
    }
  }

  function clearAll(){
    ended.value=""; trial.value=""; day1.value=""; day2.value="";
    picked.clear(); renderCalendar(); renderPickedBadges();
    err.hidden=true; outOld.hidden=true; outNew.hidden=true; list.innerHTML=""; daysTag.textContent="";
    setMode(false);
  }

  // Events
  document.getElementById("go").onclick=run;
  document.getElementById("clear").onclick=clearAll;
  [ended,trial,day1,day2].forEach(el=>el.addEventListener("keydown",e=>{ if(e.key==="Enter") run(); }));

  // Init
  const today=toYMD(new Date());
  ended.value=today; trial.value=today;
  renderCalendar(); renderPickedBadges();
})();
</script>
</body>
</html>
