<!doctype html>
<html lang="az">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>D…ôrs Planƒ± ‚Äî Multi-se√ßim + Light/Dark</title>
<style>
  :root{
    --bg:#0b1220;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--br:#334155;--btn:#0ea5e9;--sel:#22c55e
  }
  body.light{
    --bg:#f8fafc;--card:#ffffff;--text:#111827;--muted:#475569;--br:#cbd5e1;--btn:#0ea5e9;--sel:#16a34a
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 -apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;padding:16px;transition:background .3s,color .3s}
  .wrap{max-width:820px;margin:0 auto}
  .card{background:var(--card);border:1px solid var(--br);border-radius:16px;padding:16px;transition:background .3s,border-color .3s}
  h1{margin:0 0 8px;font-size:22px}
  p.lead{margin:0 0 12px;color:var(--muted)}
  label{display:block;margin:6px 0 6px;color:var(--muted);font-size:13px}
  input,select,button{
    width:100%;padding:10px 12px;border:1px solid var(--br);border-radius:12px;background:var(--bg);color:var(--text);transition:all .3s
  }
  .seg{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 12px}
  .seg button{flex:1 1 120px;padding:10px 12px;border-radius:10px;border:1px solid var(--br);background:var(--bg);color:var(--text);font-weight:700}
  .seg button[aria-pressed="true"]{background:var(--btn);border-color:var(--btn);color:#fff}
  .grid{display:flex;gap:12px;flex-wrap:wrap}
  .ctrl{flex:1 1 250px;min-width:200px}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .btn{background:var(--btn);border-color:var(--btn);color:#fff;font-weight:700;cursor:pointer}
  .ghost{background:transparent}
  .box{margin-top:14px;padding:12px;border:1px dashed var(--br);border-radius:12px}
  .err{color:#ef4444;margin-top:6px}
  .warn{color:#f59e0b;margin:6px 0}
  .muted{color:var(--muted);font-size:12px}
  .themeToggle{float:right;margin-bottom:12px}

  /* Multi-select calendar */
  .cal{border:1px solid var(--br);border-radius:12px;overflow:hidden;margin-top:8px}
  .calHead{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-bottom:1px solid var(--br);background:var(--card)}
  .calHead h3{margin:0;font-size:16px}
  .calHead .nav{display:flex;gap:6px}
  .calGrid{display:grid;grid-template-columns:repeat(7,1fr)}
  .dow,.day{padding:9px 0;text-align:center;border-bottom:1px solid var(--br)}
  .dow{font-size:12px;color:var(--muted)}
  .day{cursor:pointer}
  .day.other{color:var(--muted)}
  .day.sel{background:rgba(34,197,94,.18)}
  .day.today{outline:2px solid var(--btn);outline-offset:-2px;border-radius:6px}
  .badgeWrap{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--br);border-radius:999px;background:var(--bg);font-size:12px}
  .badge b{color:var(--text)}
  .x{background:transparent;border:1px solid var(--br);border-radius:8px;padding:2px 6px;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <button id="themeBtn" class="themeToggle" type="button">üåû Light / üåô Dark</button>
    <h1>D…ôrs Planƒ±</h1>
    <p class="lead">Rejim se√ß: <b>‚Äì Normal</b> v…ô ya <b>+ Sƒ±naq</b>. H…ôft…ôd…ô 2 g√ºn se√ß. ‚ÄúD…ôrs olmadƒ±‚Äù g√ºnl…ôrini t…ôqvimd…ôn <u>√ßox-se√ßiml…ô</u> i≈üar…ôl…ô.</p>

    <!-- Rejim -->
    <div class="seg" role="group" aria-label="Sƒ±naq rejimi">
      <button id="modeNo"  type="button" aria-pressed="true">‚Äì Normal</button>
      <button id="modeYes" type="button" aria-pressed="false">+ Sƒ±naq</button>
    </div>

    <div class="grid">
      <!-- Normal: 7 d…ôrs bit…ôn tarix -->
      <div class="ctrl" id="paneNormal">
        <label for="ended">7 d…ôrs n…ô vaxt bitdi? (YYYY-MM-DD)</label>
        <input id="ended" type="date">
        <div class="muted">‚ÄúD…ôrs 08‚Äù bu tarixd…ôn <b>sonrakƒ±</b> uyƒüun g√ºn…ô d√º≈ü…ôc…ôk.</div>
      </div>

      <!-- Sƒ±naq: sƒ±naq tarixi -->
      <div class="ctrl" id="paneTrial" style="display:none">
        <label for="trial">Sƒ±naq d…ôrsi tarixi (YYYY-MM-DD)</label>
        <input id="trial" type="date">
        <div class="muted">‚ÄúD…ôrs 01: Sƒ±naq d…ôrsi‚Äù bu tarixd…ô qeyd olunur.</div>
      </div>

      <div class="ctrl">
        <label>H…ôft…ôd…ô <b>iki g√ºn</b> se√ß (1‚Äì7)</label>
        <div class="grid">
          <select id="day1" aria-label="G√ºn 1">
            <option value="">‚Äî G√ºn 1 ‚Äî</option>
            <option value="1">1 (Bazar ert…ôsi)</option>
            <option value="2">2 (√á…ôr≈ü…ônb…ô ax≈üamƒ±)</option>
            <option value="3">3 (√á…ôr≈ü…ônb…ô)</option>
            <option value="4">4 (C√ºm…ô ax≈üamƒ±)</option>
            <option value="5">5 (C√ºm…ô)</option>
            <option value="6">6 (≈û…ônb…ô)</option>
            <option value="7">7 (Bazar)</option>
          </select>
          <select id="day2" aria-label="G√ºn 2">
            <option value="">‚Äî G√ºn 2 ‚Äî</option>
            <option value="1">1 (Bazar ert…ôsi)</option>
            <option value="2">2 (√á…ôr≈ü…ônb…ô ax≈üamƒ±)</option>
            <option value="3">3 (√á…ôr≈ü…ônb…ô)</option>
            <option value="4">4 (C√ºm…ô ax≈üamƒ±)</option>
            <option value="5">5 (C√ºm…ô)</option>
            <option value="6">6 (≈û…ônb…ô)</option>
            <option value="7">7 (Bazar)</option>
          </select>
        </div>
        <div class="muted">M…ôs: 1 v…ô 5.</div>
      </div>
    </div>

    <!-- Multi-select Calendar for ‚Äúskip days‚Äù -->
    <label style="margin-top:8px">D…ôrs <b>olmadƒ±</b> g√ºnl…ôri (t…ôqvimd…ôn √ßox-se√ßim):</label>
    <div class="cal" id="calendar">
      <div class="calHead">
        <div class="nav">
          <button id="prev" type="button">‚üµ</button>
          <button id="todayBtn" type="button">Bug√ºn</button>
          <button id="next" type="button">‚ü∂</button>
        </div>
        <h3 id="calTitle">Ay, ƒ∞l</h3>
        <div></div>
      </div>
      <div class="calGrid" id="calGrid"></div>
    </div>
    <div class="badgeWrap" id="pickedWrap"></div>

    <div class="actions">
      <button id="go" class="btn" type="button">Hesabla</button>
      <button id="clear" class="ghost" type="button">T…ômizl…ô</button>
    </div>

    <div id="err" class="err" hidden></div>

    <div id="outOld" class="box" hidden></div>
    <div id="outNew" class="box" hidden>
      <div><b>Yeni ay planƒ±</b> ‚Äî <span id="daysTag" class="muted"></span></div>
      <ol id="list"></ol>
    </div>

    <div class="muted" style="margin-top:6px">G√ºn x…ôrit…ôsi: 1-B.e., 2-√á.a., 3-√á., 4-C.a., 5-C., 6-≈û., 7-B.</div>
  </div>
</div>

<script>
(function(){
  // Tema
  const themeBtn=document.getElementById("themeBtn");
  themeBtn.addEventListener("click",()=>document.body.classList.toggle("light"));

  // Ay / g√ºn adlarƒ±
  const months = ["Yanvar","Fevral","Mart","Aprel","May","ƒ∞yun","ƒ∞yul","Avqust","Sentyabr","Oktyabr","Noyabr","Dekabr"];
  const weekdaysShort = ["B.e.","√á.a.","√á.","C.a.","C.","≈û.","B."];
  const weekdaysFull  = ["Bazar","Bazar ert…ôsi","√á…ôr≈ü…ônb…ô ax≈üamƒ±","√á…ôr≈ü…ônb…ô","C√ºm…ô ax≈üamƒ±","C√ºm…ô","≈û…ônb…ô"];

  // 1..7 ‚Üî JS getDay()
  const jsDowToNum = d => d===0 ? 7 : d;
  const numToName  = n => ["","Bazar ert…ôsi","√á…ôr≈ü…ônb…ô ax≈üamƒ±","√á…ôr≈ü…ônb…ô","C√ºm…ô ax≈üamƒ±","C√ºm…ô","≈û…ônb…ô","Bazar"][n];

  const $ = id => document.getElementById(id);
  const modeNo=$("modeNo"), modeYes=$("modeYes"), paneNormal=$("paneNormal"), paneTrial=$("paneTrial");
  const ended=$("ended"), trial=$("trial"), day1=$("day1"), day2=$("day2");
  const go=$("go"), clearBtn=$("clear"), err=$("err"), outOld=$("outOld"), outNew=$("outNew"), list=$("list"), daysTag=$("daysTag");

  // ==== MULTI-SELECT CALENDAR ====
  const calTitle=$("calTitle"), calGrid=$("calGrid"), pickedWrap=$("pickedWrap");
  const prevBtn=$("prev"), nextBtn=$("next"), todayBtn=$("todayBtn");

  const picked = new Set(); // YYYY-MM-DD
  let view = (function(){ const n=new Date(); return new Date(n.getFullYear(), n.getMonth(), 1); })();

  function toYMD(d){ const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${dd}`; }
  function parseYMD(s){ const m=/^(\d{4})-(\d{2})-(\d{2})$/.exec(s); if(!m) return null; return new Date(+m[1],+m[2]-1,+m[3]); }
  function addDays(d,n){ const x=new Date(d.getFullYear(), d.getMonth(), d.getDate()); x.setDate(x.getDate()+n); return x; }
  function fmtFull(d){ return `${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}, ${weekdaysFull[d.getDay()]}`; }

  function renderPickedBadges(){
    pickedWrap.innerHTML = "";
    Array.from(picked).sort().forEach(s=>{
      const d=parseYMD(s);
      const b=document.createElement("div");
      b.className="badge";
      b.innerHTML=`<b>${s}</b> <span>${weekdaysFull[d.getDay()]}</span> <button class="x" data-x="${s}" type="button">sil</button>`;
      pickedWrap.appendChild(b);
    });
    pickedWrap.querySelectorAll("button.x").forEach(btn=>{
      btn.addEventListener("click",(e)=>{ const v=e.currentTarget.getAttribute("data-x"); picked.delete(v); renderCalendar(); renderPickedBadges(); });
    });
  }

  function renderCalendar(){
    calTitle.textContent = `${months[view.getMonth()]} ${view.getFullYear()}`;
    calGrid.innerHTML = "";
    // headers Mon..Sun
    for(let i=0;i<7;i++){ const h=document.createElement("div"); h.className="dow"; h.textContent=weekdaysShort[i]; calGrid.appendChild(h); }

    const first = new Date(view.getFullYear(), view.getMonth(), 1);
    const firstDow = jsDowToNum(first.getDay()); // 1..7
    const leading = (firstDow + 6) % 7; // how many before Monday
    const start = addDays(first, -leading);
    const todayStr = toYMD(new Date());

    for(let i=0;i<42;i++){
      const slot = addDays(start, i);
      const ymd = toYMD(slot);
      const cell = document.createElement("div");
      cell.className = "day";
      if(slot.getMonth()!==view.getMonth()) cell.classList.add("other");
      if(ymd===todayStr) cell.classList.add("today");
      if(picked.has(ymd)) cell.classList.add("sel");
      cell.textContent = slot.getDate();
      cell.setAttribute("data-ymd", ymd);
      cell.addEventListener("click", ()=>{
        if(picked.has(ymd)) picked.delete(ymd); else picked.add(ymd);
        renderCalendar(); renderPickedBadges();
      });
      calGrid.appendChild(cell);
    }
  }
  prevBtn.addEventListener("click", ()=>{ view=new Date(view.getFullYear(), view.getMonth()-1, 1); renderCalendar(); });
  nextBtn.addEventListener("click", ()=>{ view=new Date(view.getFullYear(), view.getMonth()+1, 1); renderCalendar(); });
  todayBtn.addEventListener("click", ()=>{ const n=new Date(); view=new Date(n.getFullYear(), n.getMonth(), 1); renderCalendar(); });

  // ==== MODE SWITCH ====
  function setMode(trialMode){
    modeNo.setAttribute("aria-pressed", String(!trialMode));
    modeYes.setAttribute("aria-pressed", String(trialMode));
    paneNormal.style.display = trialMode ? "none":"block";
    paneTrial.style.display  = trialMode ? "block":"none";
  }
  modeNo.addEventListener("click", ()=>setMode(false));
  modeYes.addEventListener("click", ()=>setMode(true));

  // ==== Planner core ====
  function nextAfter(date, allowedDays, skipSet){
    let d = addDays(date, 1);
    while(true){
      const okDay = allowedDays.includes(jsDowToNum(d.getDay()));
      const isSkip = skipSet.has(toYMD(d));
      if(okDay && !isSkip) return {date:d, moved:false, movedFrom:null};
      if(okDay && isSkip){
        const from=d;
        do{ d=addDays(d,1); } while( !allowedDays.includes(jsDowToNum(d.getDay())) || skipSet.has(toYMD(d)) );
        return {date:d, moved:true, movedFrom:from};
      }
      d = addDays(d,1);
    }
  }
  function buildPlan(startExclusive, daysAllowed, skipSet, N){
    const res=[]; let cur=startExclusive;
    for(let i=1;i<=N;i++){ const step=nextAfter(cur, daysAllowed, skipSet); res.push(step); cur=step.date; }
    return res;
  }

  function validate(){
    err.hidden = true;
    const trialMode = modeYes.getAttribute("aria-pressed")==="true";
    const g1 = parseInt(day1.value,10), g2 = parseInt(day2.value,10);
    if(!(g1>=1&&g1<=7) || !(g2>=1&&g2<=7) || g1===g2){
      err.textContent = "H…ôft…ôd…ô iki f…ôrqli g√ºn se√ßin (m…ôs: 1 v…ô 5)."; err.hidden=false; return null;
    }
    const skipSet = new Set(Array.from(picked));
    if(trialMode){
      const t = trial.value ? parseYMD(trial.value) : null;
      if(!t){ err.textContent = "Sƒ±naq rejimind…ô sƒ±naq d…ôrsinin tarixini se√ßin."; err.hidden=false; return null; }
      return {trialMode:true, trial:t, days:[g1,g2].sort((a,b)=>a-b), skip:skipSet};
    }else{
      const b = ended.value ? parseYMD(ended.value) : null;
      if(!b){ err.textContent = "Normal rejimd…ô 7 d…ôrsin bitdiyi tarixi se√ßin."; err.hidden=false; return null; }
      return {trialMode:false, base:b, days:[g1,g2].sort((a,b)=>a-b), skip:skipSet};
    }
  }
  function parseYMD(s){ const m=/^(\d{4})-(\d{2})-(\d{2})$/.exec(s); if(!m) return null; return new Date(+m[1],+m[2]-1,+m[3]); }
  function toYMD(d){ const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${dd}`; }
  function addDays(d,n){ const x=new Date(d.getFullYear(), d.getMonth(), d.getDate()); x.setDate(x.getDate()+n); return x; }
  function fmtFull(d){ const months=["Yanvar","Fevral","Mart","Aprel","May","ƒ∞yun","ƒ∞yul","Avqust","Sentyabr","Oktyabr","Noyabr","Dekabr"]; const wd=["Bazar","Bazar ert…ôsi","√á…ôr≈ü…ônb…ô ax≈üamƒ±","√á…ôr≈ü…ônb…ô","C√ºm…ô ax≈üamƒ±","C√ºm…ô","≈û…ônb…ô"]; return `${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}, ${wd[d.getDay()]}`; }

  function run(){
    const p = validate(); if(!p) return;
    outOld.hidden = true; outNew.hidden = true; list.innerHTML = "";
    daysTag.textContent = `G√ºnl…ôr: ${p.days[0]} (${numToName(p.days[0])}), ${p.days[1]} (${numToName(p.days[1])})`;

    if(p.trialMode){
      // D…ôrs 01 = sƒ±naq
      outNew.hidden = false;
      const li0=document.createElement("li");
      li0.innerHTML=`<b>D…ôrs 01:</b> Sƒ±naq d…ôrsi ‚Äî ${fmtFull(p.trial)}`;
      list.appendChild(li0);
      // 02..08
      const plan = buildPlan(p.trial, p.days, p.skip, 7);
      plan.forEach((item, idx)=>{
        const n = idx+2;
      const li=document.createElement("li");
        li.innerHTML=`<b>D…ôrs ${String(n).padStart(2,'0')}:</b> ${fmtFull(item.date)}`;
        list.appendChild(li);
        if(item.moved){
          const note=document.createElement("div"); note.className="warn";
          note.textContent=`Bu g√ºn d…ôrs olmadƒ±: ${fmtFull(item.movedFrom)} ‚Üí n√∂vb…ôti d…ôrs g√ºn√ºn…ô ke√ßirildi.`;
          list.appendChild(note);
        }
      });
    }else{
      // K√∂hn…ô ay D…ôrs 08
      const old8 = nextAfter(p.base, p.days, p.skip);
      outOld.hidden = false;
      outOld.innerHTML = `<b>K√∂hn…ô ay ‚Äî D…ôrs 08:</b> ${fmtFull(old8.date)}`
        + (old8.moved ? `<div class="warn">Bu g√ºn d…ôrs olmadƒ±: ${fmtFull(old8.movedFrom)} ‚Üí n√∂vb…ôti uyƒüun g√ºn…ô ke√ßirildi.</div>` : "");
      // Yeni ay 01..08
      outNew.hidden = false;
      const plan = buildPlan(old8.date, p.days, p.skip, 8);
      plan.forEach((item, idx)=>{
        const li=document.createElement("li");
        li.innerHTML=`<b>D…ôrs ${String(idx+1).padStart(2,'0')}:</b> ${fmtFull(item.date)}`;
        list.appendChild(li);
        if(item.moved){
          const note=document.createElement("div"); note.className="warn";
          note.textContent=`Bu g√ºn d…ôrs olmadƒ±: ${fmtFull(item.movedFrom)} ‚Üí n√∂vb…ôti d…ôrs g√ºn√ºn…ô ke√ßirildi.`;
          list.appendChild(note);
        }
      });
    }
  }

  function clearAll(){
    ended.value=""; trial.value=""; day1.value=""; day2.value="";
    picked.clear(); renderCalendar(); renderPickedBadges();
    err.hidden=true; outOld.hidden=true; outNew.hidden=true; list.innerHTML=""; daysTag.textContent="";
    setMode(false);
  }

  // Events
  go.addEventListener("click", run);
  clearBtn.addEventListener("click", clearAll);
  [ended, trial, day1, day2].forEach(el=>el.addEventListener("keydown", e=>{ if(e.key==="Enter") run(); }));

  // Init defaults
  const now=new Date();
  const today=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
  ended.value=today; trial.value=today;
  renderCalendar(); renderPickedBadges();
})();
</script>
</body>
</html>
